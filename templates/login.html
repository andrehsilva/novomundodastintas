{% extends 'base.html' %}

{% block content %}
<div class="flex justify-center items-center min-h-[85vh] bg-gradient-to-br from-base-200 to-base-300 p-4">
  <div class="card w-full max-w-md bg-base-100 shadow-2xl border border-base-300 overflow-hidden">
    
    <div class="bg-[#00295d] p-8 text-center">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/10 mb-4">
        <i class="fa-solid fa-user-lock text-3xl text-white"></i>
      </div>
      <h2 class="text-2xl font-bold text-white">Bem-vindo de volta!</h2>
      <p class="text-blue-100/70 text-sm mt-1">Acesse sua conta para gerenciar seus pontos.</p>
    </div>

    <div class="card-body p-8">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert {% if category == 'error' %}alert-error{% else %}alert-info{% endif %} mb-4 shadow-sm">
              <i class="fa-solid fa-circle-exclamation"></i>
              <span>{{ message }}</span>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="post" id="loginForm" class="space-y-6">
        <div class="form-control">
          <label class="label pt-0">
            <span class="label-text font-bold text-gray-600">Telefone Celular</span>
          </label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400">
              <i class="fa-solid fa-phone"></i>
            </span>
            <input
              type="text"
              name="telefone"
              id="login_telefone"
              placeholder="(00) 00000-0000"
              class="input input-bordered w-full pl-12 bg-gray-50 focus:bg-white transition-all text-lg"
              required
            />
          </div>
          <label class="label">
            <span id="tel_helper" class="label-text-alt text-gray-400">Digite seu DDD + número</span>
            <span id="char_counter" class="label-text-alt font-mono">0/11</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label pt-0">
            <span class="label-text font-bold text-gray-600">Sua Senha</span>
          </label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400">
              <i class="fa-solid fa-key"></i>
            </span>
            <input
              type="password"
              name="senha"
              class="input input-bordered w-full pl-12 bg-gray-50 focus:bg-white transition-all text-lg"
              required
            />
          </div>
          <div class="flex justify-end mt-2">
            <a href="{{ url_for('esqueci_senha') }}" class="text-sm link link-primary no-underline hover:underline font-medium">
              Esqueci a senha?
            </a>
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-full text-lg font-bold shadow-lg hover:scale-[1.02] active:scale-[0.98] transition-all">
            Entrar no Painel
        </button>
      </form>

      <div class="divider my-8 text-gray-400 text-xs">AINDA NÃO TEM CONTA?</div>
      
      <a href="{{ url_for('register') }}" class="btn btn-outline btn-primary w-full border-2 hover:bg-primary/5">
        Solicitar Cadastro de Pintor
      </a>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
  $(document).ready(function () {
    const $tel = $('#login_telefone');
    const $counter = $('#char_counter');

    // Máscara fixa para 11 dígitos (Celular com 9)
    $tel.mask('(00) 00000-0000', {
      onKeyPress: function(val, e, field, options) {
        // Atualiza o contador visual de dígitos
        const digits = val.replace(/\D/g, "").length;
        $counter.text(digits + '/11');
        
        if(digits === 11) {
            $counter.addClass('text-success font-bold').removeClass('text-gray-400');
        } else {
            $counter.removeClass('text-success font-bold').addClass('text-gray-400');
        }
      }
    });

    // Validação de travamento no submit
    $('#loginForm').on('submit', function (e) {
      const digits = $tel.val().replace(/\D/g, "");
      
      if (digits.length < 11) {
        e.preventDefault();
        $tel.addClass('input-error');
        alert("Por favor, insira o número completo com DDD (11 dígitos).");
        $tel.focus();
      }
    });

    // Remove erro ao digitar
    $tel.on('input', function() {
        $(this).removeClass('input-error');
    });
  });
</script>
{% endblock %}